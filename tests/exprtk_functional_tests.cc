#include <gtest/gtest.h>

#include <cmath>
#include <string>
#include <vector>

#include "spice_expr/spice_expr.h"

using namespace spice_expr;

// Auto-generated from ExprTK test files
// Syntax adaptations:
// - x^y -> x**y (power operator)
// - and/or -> &&/||
// - if(c,t,f) -> (c)?(t):(f)
// - <> -> !=
// - Tests using ExprTK-specific features are omitted

struct TestExpr {
  std::string expr;
  double expected;
};

class ExprtkFunctionalTest : public ::testing::TestWithParam<TestExpr> {
 protected:
  ExprArena arena;
  SymbolTable symbols;
  FunctionRegistry functions;
  NullCircuitInterface circuit;

  double evaluate(const std::string& expr_str) {
    ExprNode* expr = parse_expression(expr_str, arena);
    RealEvaluator eval(symbols, functions, circuit);
    return eval.evaluate(*expr);
  }
};

TEST_P(ExprtkFunctionalTest, EvaluatesCorrectly) {
  const auto& test = GetParam();
  double result = evaluate(test.expr);
  if (std::abs(test.expected) < 1e-10) {
    EXPECT_NEAR(result, test.expected, 1e-10) << "Expr: " << test.expr;
  } else {
    EXPECT_NEAR(result, test.expected, std::abs(test.expected) * 1e-10) << "Expr: " << test.expr;
  }
}

static const std::vector<TestExpr> functional_tests_0 = {
    {"1.0", 1.0},
    {"2.0", 2.0},
    {"3.0", 3.0},
    {"4.0", 4.0},
    {"5.0", 5.0},
    {"6.0", 6.0},
    {"7.0", 7.0},
    {"8.0", 8.0},
    {"9.0", 9.0},
    {"12.12", 12.12},
    {"123.123", 123.123},
    {"1234.1234", 1234.1234},
    {"12345.12345", 12345.12345},
    {"123456.123456", 123456.123456},
    {"0.0", 0.0},
    {"1.0", 1.0},
    {"2.0", 2.0},
    {"3.0", 3.0},
    {"4.0", 4.0},
    {"5.0", 5.0},
    {"6.0", 6.0},
    {"7.0", 7.0},
    {"8.0", 8.0},
    {"9.0", 9.0},
    {"0.0", 0.0},
    {"1.1", 1.1},
    {"2.2", 2.2},
    {"3.3", 3.3},
    {"4.4", 4.4},
    {"5.5", 5.5},
    {"6.6", 6.6},
    {"7.7", 7.7},
    {"8.8", 8.8},
    {"9.9", 9.9},
    {"0.0", 0.0},
    {"1.0", 1.0},
    {"2.0", 2.0},
    {"3.0", 3.0},
    {"4.0", 4.0},
    {"5.0", 5.0},
    {"6.0", 6.0},
    {"7.0", 7.0},
    {"8.0", 8.0},
    {"9.0", 9.0},
    {"0.0", 0.0},
    {"1.0", 1.0},
    {"2.0", 2.0},
    {"3.0", 3.0},
    {"4.0", 4.0},
    {"5.0", 5.0},
    {"6.0", 6.0},
    {"7.0", 7.0},
    {"8.0", 8.0},
    {"9.0", 9.0},
    {"0.0", 0.0},
    {"1.1", 1.1},
    {"2.2", 2.2},
    {"3.3", 3.3},
    {"4.4", 4.4},
    {"5.5", 5.5},
    {"6.6", 6.6},
    {"7.7", 7.7},
    {"8.8", 8.8},
    {"9.9", 9.9},
    {"-0.0", 0.0},
    {"-1.0", -1.0},
    {"-2.0", -2.0},
    {"-3.0", -3.0},
    {"-4.0", -4.0},
    {"-5.0", -5.0},
    {"-6.0", -6.0},
    {"-7.0", -7.0},
    {"-8.0", -8.0},
    {"-9.0", -9.0},
    {"-0.0", 0.0},
    {"-1.0", -1.0},
    {"-2.0", -2.0},
    {"-3.0", -3.0},
    {"-4.0", -4.0},
    {"-5.0", -5.0},
    {"-6.0", -6.0},
    {"-7.0", -7.0},
    {"-8.0", -8.0},
    {"-9.0", -9.0},
    {"-0.0", 0.0},
    {"-1.1", -1.1},
    {"-2.2", -2.2},
    {"-3.3", -3.3},
    {"-4.4", -4.4},
    {"-5.5", -5.5},
    {"-6.6", -6.6},
    {"-7.7", -7.7},
    {"-8.8", -8.8},
    {"-9.9", -9.9},
    {"+0.0e+0", 0.0},
    {"+1.1e+1", 11.0},
    {"+2.2e+2", 220.0},
    {"+3.3e+3", 3300.0},
    {"+4.4e+4", 44000.0},
    {"+5.5e+5", 550000.0},
    {"+6.6e+6", 6600000.0},
    {"+7.7e+7", 77000000.0},
    {"+8.8e+8", 880000000.0},
    {"+9.9e+9", 9900000000.0},
    {"-0.0e+0", 0.0},
    {"-1.1e+1", -11.0},
    {"-2.2e+2", -220.0},
    {"-3.3e+3", -3300.0},
    {"-4.4e+4", -44000.0},
    {"-5.5e+5", -550000.0},
    {"-6.6e+6", -6600000.0},
    {"-7.7e+7", -77000000.0},
    {"-8.8e+8", -880000000.0},
    {"-9.9e+9", -9900000000.0},
    {"+0.0E+0", 0.0},
    {"+1.1E+1", 11.0},
    {"+2.2E+2", 220.0},
    {"+3.3E+3", 3300.0},
    {"+4.4E+4", 44000.0},
    {"+5.5E+5", 550000.0},
    {"+6.6E+6", 6600000.0},
    {"+7.7E+7", 77000000.0},
    {"+8.8E+8", 880000000.0},
    {"+9.9E+9", 9900000000.0},
    {"-0.0E+0", 0.0},
    {"-1.1E+1", -11.0},
    {"-2.2E+2", -220.0},
    {"-3.3E+3", -3300.0},
    {"-4.4E+4", -44000.0},
    {"-5.5E+5", -550000.0},
    {"-6.6E+6", -6600000.0},
    {"-7.7E+7", -77000000.0},
    {"-8.8E+8", -880000000.0},
    {"-9.9E+9", -9900000000.0},
    {"0.0", 0.0},
    {"1.0", 1.0},
    {"2.0", 2.0},
    {"3.0", 3.0},
    {"4.0", 4.0},
    {"5.0", 5.0},
    {"6.0", 6.0},
    {"7.0", 7.0},
    {"8.0", 8.0},
    {"9.0", 9.0},
    {"0.0", 0.0},
    {"1.0", 1.0},
    {"2.0", 2.0},
    {"3.0", 3.0},
    {"4.0", 4.0},
    {"5.0", 5.0},
    {"6.0", 6.0},
    {"7.0", 7.0},
    {"8.0", 8.0},
    {"9.0", 9.0},
    {"0.0", 0.0},
    {"1.1", 1.1},
    {"2.2", 2.2},
    {"3.3", 3.3},
    {"4.4", 4.4},
    {"5.5", 5.5},
    {"6.6", 6.6},
    {"7.7", 7.7},
    {"8.8", 8.8},
    {"9.9", 9.9},
    {"0.0", 0.0},
    {"1.0", 1.0},
    {"2.0", 2.0},
    {"3.0", 3.0},
    {"4.0", 4.0},
    {"5.0", 5.0},
    {"6.0", 6.0},
    {"7.0", 7.0},
    {"8.0", 8.0},
    {"9.0", 9.0},
    {"0.0", 0.0},
    {"1.0", 1.0},
    {"2.0", 2.0},
    {"3.0", 3.0},
    {"4.0", 4.0},
    {"5.0", 5.0},
    {"6.0", 6.0},
    {"7.0", 7.0},
    {"8.0", 8.0},
    {"9.0", 9.0},
    {"0.0", 0.0},
    {"1.1", 1.1},
    {"2.2", 2.2},
    {"3.3", 3.3},
    {"4.4", 4.4},
    {"5.5", 5.5},
    {"6.6", 6.6},
    {"7.7", 7.7},
    {"8.8", 8.8},
    {"9.9", 9.9},
    {"-0.0", 0.0},
    {"-1.0", -1.0},
    {"-2.0", -2.0},
    {"-3.0", -3.0},
    {"-4.0", -4.0},
    {"-5.0", -5.0},
    {"-6.0", -6.0},
    {"-7.0", -7.0},
    {"-8.0", -8.0},
    {"-9.0", -9.0},
    {"-0.0", 0.0},
    {"-1.0", -1.0},
    {"-2.0", -2.0},
    {"-3.0", -3.0},
    {"-4.0", -4.0},
    {"-5.0", -5.0},
    {"-6.0", -6.0},
    {"-7.0", -7.0},
    {"-8.0", -8.0},
    {"-9.0", -9.0},
    {"-0.0", 0.0},
    {"-1.1", -1.1},
    {"-2.2", -2.2},
    {"-3.3", -3.3},
    {"-4.4", -4.4},
    {"-5.5", -5.5},
    {"-6.6", -6.6},
    {"-7.7", -7.7},
    {"-8.8", -8.8},
    {"-9.9", -9.9},
    {"1234567890", 1234567890.0},
    {"123456789.0", 123456789.0},
    {"1234567890", 1234567890.0},
    {"123456789.0", 123456789.0},
    {"-1234567890", -1234567890.0},
    {"-123456789.0", -123456789.0},
    {"1234.567890", 1234.56789},
    {"-1234.567890", -1234.56789},
    {"0+9", 9.0},
    {"1+8", 9.0},
    {"2+7", 9.0},
    {"3+6", 9.0},
    {"4+5", 9.0},
    {"5+4", 9.0},
    {"6+3", 9.0},
    {"7+2", 9.0},
    {"8+1", 9.0},
    {"9+0", 9.0},
    {"0+9", 9.0},
    {"1+8", 9.0},
    {"2+7", 9.0},
    {"3+6", 9.0},
    {"4+5", 9.0},
    {"5+4", 9.0},
    {"6+3", 9.0},
    {"7+2", 9.0},
    {"8+1", 9.0},
    {"9+0", 9.0},
    {"0+9", 9.0},
    {"1+8", 9.0},
    {"2+7", 9.0},
    {"3+6", 9.0},
    {"4+5", 9.0},
    {"5+4", 9.0},
    {"6+3", 9.0},
    {"7+2", 9.0},
    {"8+1", 9.0},
    {"9+0", 9.0},
    {"1+2", 3.0},
    {"1-2", -1.0},
    {"1*2", 2.0},
    {"1/2", 0.5},
    {"1.1+2.2", 3.3},
    {"1.1-2.2", -1.1},
    {"1.1*2.2", 2.42},
    {"1.1/2.2", 0.5},
    {"0-9", -9.0},
    {"1-8", -7.0},
    {"2-7", -5.0},
    {"3-6", -3.0},
    {"4-5", -1.0},
    {"5-4", 1.0},
    {"6-3", 3.0},
    {"7-2", 5.0},
    {"8-1", 7.0},
    {"9-0", 9.0},
    {"0-9", -9.0},
    {"1-8", -7.0},
    {"2-7", -5.0},
    {"3-6", -3.0},
    {"4-5", -1.0},
    {"5-4", 1.0},
    {"6-3", 3.0},
    {"7-2", 5.0},
    {"8-1", 7.0},
    {"9-0", 9.0},
    {"0-9", -9.0},
    {"1-8", -7.0},
    {"2-7", -5.0},
    {"3-6", -3.0},
    {"4-5", -1.0},
    {"5-4", 1.0},
    {"6-3", 3.0},
    {"7-2", 5.0},
    {"8-1", 7.0},
    {"9-0", 9.0},
    {"-(1+2)", -3.0},
    {"+(1+2)", 3.0},
    {"+(1-2)", -1.0},
    {"-(1-2)", 1.0},
    {"1.1+2.2+3.3", 6.6},
    {"+1.1+2.2+3.3", 6.6},
    {"-1.1-2.2-3.3", -6.6},
    {"1.1*2.2*3.3", 7.986},
    {"+1.1*2.2*3.3", 7.986},
    {"-1.1*-2.2*-3.3", -7.986},
    {"1+1/2", 1.5},
    {"1+(1/2)", 1.5},
    {"1.1+1.1/2.2", 1.6},
    {"1.1+(1.1/2.2)", 1.6},
    {"2*1/2", 1.0},
    {"2*(1/2)", 1.0},
    {"2.2*1.1/2.2", 1.1},
    {"2.2*(1.1/2.2)", 1.1},
    {"1**2", 1.0},
    {"2**1", 2.0},
    {"2**3", 8.0},
    {"(-2)**3", -8.0},
    {"(-2)**4", 16.0},
    {"3**2**1", 9.0},
    {"1.1**2.2", 1.2332863005546626},
    {"2.2**1.1", 2.380482257600354},
    {"2.2**3.3", 13.489468760533384},
    {"3.3**2.2**1.1", 17.151939423713763},
    {"1.1**(1.1*2.2)", 1.2594191657629907},
    {"2.2**(1.1*3.3)", 17.498238489535346},
    {"3.3**(1.1*2.2)", 17.98058156638875},
    {"48.0/2.0*(9.0+3.0)", 288.0},
    {"1**2", 1.0},
    {"11**2", 121.0},
    {"111**2", 12321.0},
    {"1111**2", 1234321.0},
    {"11111**2", 123454321.0},
    {"111111**2", 12345654321.0},
    {"1111111**2", 1234567654321.0},
    {"11111111**2", 123456787654321.0},
    {"1<2", 1.0},
    {"1 <= 2", 1.0},
    {"1.1 <= 2.2", 1.0},
    {"(1.0+0.1) <= (2.0+0.2)", 1.0},
    {"1>2", 0.0},
    {"1 >= 2", 0.0},
    {"1.1 >= 2.2", 0.0},
    {"(1.0+0.1) >= (2.0+0.2)", 0.0},
    {"1!=2", 1.0},
    {"1 != 2", 1.0},
    {"1.1!=2.2", 1.0},
    {"1.1 != 2.2", 1.0},
    {"(1.0+0.1)!=(2.0+0.2)", 1.0},
    {"(1.0+0.1) != (2.0+0.2)", 1.0},
    {"1 == 1", 1.0},
    {"1.1 == 1.1", 1.0},
    {"1==1", 1.0},
    {"1.1==1.1", 1.0},
    {"1!=1", 0.0},
    {"1 != 1", 0.0},
    {"1.1!=1.1", 0.0},
    {"1.1 != 1.1", 0.0},
    {"(1.0+0.1)!=(1.0+0.1)", 0.0},
    {"(1.0+0.1) != (1.0+0.1)", 0.0},
    {"1 < 2 < 3", 1.0},
    {"1 <= 2 <= 3", 1.0},
    {"1 > 2 > 3", 0.0},
    {"1 >= 2 >= 3", 0.0},
    {"1 < 2 > 3", 0.0},
    {"1 < 2 >= 3", 0.0},
    {"1 <= 2 > 3", 0.0},
    {"1 > 2 < 3", 1.0},
    {"1 > 2 <= 3", 1.0},
    {"1 >= 2 < 3", 1.0},
    {"1 && 1", 1.0},
    {"1 && 0", 0.0},
    {"0 && 1", 0.0},
    {"0 && 0", 0.0},
    {"1.0 && 1.0", 1.0},
    {"1.0 && 0.0", 0.0},
    {"0.0 && 1.0", 0.0},
    {"0.0 && 0.0", 0.0},
    {"1 && 1", 1.0},
    {"1 && 0", 0.0},
    {"0 && 1", 0.0},
    {"0 && 0", 0.0},
    {"1.0 && 1.0", 1.0},
    {"1.0 && 0.0", 0.0},
    {"0.0 && 1.0", 0.0},
    {"0.0 && 0.0", 0.0},
    {"1 || 1", 1.0},
    {"1 || 0", 1.0},
    {"0 || 1", 1.0},
    {"0 || 0", 0.0},
    {"1.0 || 1.0", 1.0},
    {"1.0 || 0.0", 1.0},
    {"0.0 || 1.0", 1.0},
    {"0.0 || 0.0", 0.0},
    {"1 || 1", 1.0},
    {"1 || 0", 1.0},
    {"0 || 1", 1.0},
    {"0 || 0", 0.0},
    {"1.0 || 1.0", 1.0},
    {"1.0 || 0.0", 1.0},
    {"0.0 || 1.0", 1.0},
    {"0.0 || 0.0", 0.0},
    {"1 && 1", 1.0},
    {"1 && 0", 0.0},
    {"0 && 1", 0.0},
    {"0 && 0", 0.0},
    {"1.0 && 1.0", 1.0},
    {"1.0 && 0.0", 0.0},
    {"0.0 && 1.0", 0.0},
    {"0.0 && 0.0", 0.0},
    {"1 && 1", 1.0},
    {"1 && 0", 0.0},
    {"0 && 1", 0.0},
    {"0 && 0", 0.0},
    {"1.0 && 1.0", 1.0},
    {"1.0 && 0.0", 0.0},
    {"0.0 && 1.0", 0.0},
    {"0.0 && 0.0", 0.0},
    {"1 || 1", 1.0},
    {"1 || 0", 1.0},
    {"0 || 1", 1.0},
    {"0 || 0", 0.0},
    {"1.0 || 1.0", 1.0},
    {"1.0 || 0.0", 1.0},
    {"0.0 || 1.0", 1.0},
    {"0.0 || 0.0", 0.0},
    {"1 || 1", 1.0},
    {"1 || 0", 1.0},
    {"0 || 1", 1.0},
    {"0 || 0", 0.0},
    {"1.0 || 1.0", 1.0},
    {"1.0 || 0.0", 1.0},
    {"0.0 || 1.0", 1.0},
    {"0.0 || 0.0", 0.0},
    {"abs(1)", 1.0},
    {"abs(-1)", 1.0},
    {"abs(1.0)", 1.0},
    {"abs(-1.0)", 1.0},
    {"min(1,2)", 1.0},
    {"min(1,2,3)", 1.0},
    {"min(1,2,3,4)", 1.0},
    {"min(1,2,3,4,5)", 1.0},
    {"min(1,2,3,4,5,6)", 1.0},
    {"min(1.1,2.2)", 1.1},
    {"min(1.1,2.2,3.3)", 1.1},
    {"min(1.1,2.2,3.3,4.4)", 1.1},
    {"min(1.1,2.2,3.3,4.4,5.5)", 1.1},
    {"min(1.1,2.2,3.3,4.4,5.5,6.6)", 1.1},
    {"min(min(1,2),min(3,4))", 1.0},
    {"max(1,2)", 2.0},
    {"max(1,2,3)", 3.0},
    {"max(1,2,3,4)", 4.0},
    {"max(1,2,3,4,5)", 5.0},
    {"max(1,2,3,4,5,6)", 6.0},
    {"max(1.1,2.2)", 2.2},
    {"max(1.1,2.2,3.3)", 3.3},
    {"max(1.1,2.2,3.3,4.4)", 4.4},
    {"max(1.1,2.2,3.3,4.4,5.5)", 5.5},
    {"max(1.1,2.2,3.3,4.4,5.5,6.6)", 6.6},
    {"max(max(1,2),max(3,4))", 4.0},
    {"floor(1.0)", 1.0},
    {"floor(1.1)", 1.0},
    {"floor(-1.0)", -1.0},
    {"floor(-1.1)", -2.0},
    {"ceil(1.0)", 1.0},
    {"ceil(1.1)", 2.0},
    {"ceil(-1.0)", -1.0},
    {"ceil(-1.1)", -1.0},
    {"round(1.1)", 1.0},
    {"round(1.49)", 1.0},
    {"round(1.5)", 2.0},
    {"round(1.9)", 2.0},
    {"cos(0.0)", 1.0},
    {"sin(0.0)", 0.0},
    {"sin( 0.0000000)", 0.0},
    {"sin(-0.0000000)", 0.0},
    {"sin(+0.0000000)", 0.0},
    {"sin(+0.0000001)", 9.999999999999984e-08},
    {"sin(-0.0000001)", -9.999999999999984e-08},
    {"sin(+0.1111111)", 0.11088261746735843},
    {"sin(-0.1111111)", -0.11088261746735843},
    {"sin(+0.2222222)", 0.22039772178034256},
    {"sin(-0.2222222)", -0.22039772178034256},
    {"sin(+0.3333333)", 0.3271946652975872},
    {"sin(-0.3333333)", -0.3271946652975872},
    {"sin(+0.5000000)", 0.479425538604203},
    {"sin(-0.5000000)", -0.479425538604203},
    {"sin(+1.0000000)", 0.8414709848078965},
    {"sin(-1.0000000)", -0.8414709848078965},
    {"sin(+10.000000)", -0.5440211108893698},
    {"sin(-10.000000)", 0.5440211108893698},
    {"sin(+100.00000)", -0.5063656411097588},
    {"sin(-100.00000)", 0.5063656411097588},
    {"sin(+1000.0000)", 0.8268795405320025},
    {"sin(-1000.0000)", -0.8268795405320025},
    {"sin(+10000.000)", -0.30561438888825215},
};

INSTANTIATE_TEST_SUITE_P(Functional_0, ExprtkFunctionalTest,
                         ::testing::ValuesIn(functional_tests_0));

static const std::vector<TestExpr> functional_tests_1 = {
    {"sin(-10000.000)", 0.30561438888825215},
    {"sin(+100000.00)", 0.03574879797201651},
    {"sin(-100000.00)", -0.03574879797201651},
    {"sin(+11.000000)", -0.9999902065507035},
    {"sin(-11.000000)", 0.9999902065507035},
    {"sin(+101.00000)", 0.45202578717835057},
    {"sin(-101.00000)", -0.45202578717835057},
    {"sin(+1001.0000)", 0.9199905975863218},
    {"sin(-1001.0000)", -0.9199905975863218},
    {"sin(+10001.000)", -0.9663352744418436},
    {"sin(-10001.000)", 0.9663352744418436},
    {"sin(+100001.00)", -0.8216179648371524},
    {"sin(-100001.00)", 0.8216179648371524},
    {"sin(+1000001.0)", 0.5991474390141922},
    {"sin(-1000001.0)", -0.5991474390141922},
    {"sin(+6.59705e7)", 0.8859430465030943},
    {"sin(-6.59705e7)", -0.8859430465030943},
    {"cos( 0.0000000)", 1.0},
    {"cos(-0.0000000)", 1.0},
    {"cos(+0.0000000)", 1.0},
    {"cos(+0.0000001)", 0.999999999999995},
    {"cos(-0.0000001)", 0.999999999999995},
    {"cos(+0.1111111)", 0.9938335097709211},
    {"cos(-0.1111111)", 0.9938335097709211},
    {"cos(+0.2222222)", 0.975410090287175},
    {"cos(-0.2222222)", 0.975410090287175},
    {"cos(+0.3333333)", 0.9449569572212271},
    {"cos(-0.3333333)", 0.9449569572212271},
    {"cos(+0.5000000)", 0.8775825618903728},
    {"cos(-0.5000000)", 0.8775825618903728},
    {"cos(+1.0000000)", 0.5403023058681398},
    {"cos(-1.0000000)", 0.5403023058681398},
    {"cos(+10.000000)", -0.8390715290764524},
    {"cos(-10.000000)", -0.8390715290764524},
    {"cos(+100.00000)", 0.8623188722876839},
    {"cos(-100.00000)", 0.8623188722876839},
    {"cos(+1000.0000)", 0.5623790762907029},
    {"cos(-1000.0000)", 0.5623790762907029},
    {"cos(+10000.000)", -0.9521553682590148},
    {"cos(-10000.000)", -0.9521553682590148},
    {"cos(+100000.00)", -0.9993608074382124},
    {"cos(-100000.00)", -0.9993608074382124},
    {"cos(+11.000000)", 0.004425697988050785},
    {"cos(-11.000000)", 0.004425697988050785},
    {"cos(+101.00000)", 0.8920048697881602},
    {"cos(-101.00000)", 0.8920048697881602},
    {"cos(+1001.0000)", -0.3919404295971039},
    {"cos(-1001.0000)", -0.3919404295971039},
    {"cos(+10001.000)", -0.25728610022581244},
    {"cos(-10001.000)", -0.25728610022581244},
    {"cos(+100001.00)", -0.5700385248883234},
    {"cos(-100001.00)", -0.5700385248883234},
    {"cos(+1000001.0)", 0.8006387114814864},
    {"cos(-1000001.0)", 0.8006387114814864},
    {"cos(+6.59705e7)", 0.46379404734517254},
    {"cos(-6.59705e7)", 0.46379404734517254},
    {"tan( 0.0000000)", 0.0},
    {"tan(-0.0000000)", 0.0},
    {"tan(+0.0000000)", 0.0},
    {"tan(+0.0000001)", 1.0000000000000034e-07},
    {"tan(-0.0000001)", -1.0000000000000034e-07},
    {"tan(+0.1111111)", 0.11157061658437832},
    {"tan(-0.1111111)", -0.11157061658437832},
    {"tan(+0.2222222)", 0.22595390797675086},
    {"tan(-0.2222222)", -0.22595390797675086},
    {"tan(+0.3333333)", 0.3462535121808586},
    {"tan(-0.3333333)", -0.3462535121808586},
    {"tan(+0.5000000)", 0.5463024898437905},
    {"tan(-0.5000000)", -0.5463024898437905},
    {"tan(+1.0000000)", 1.5574077246549023},
    {"tan(-1.0000000)", -1.5574077246549023},
    {"tan(+10.000000)", 0.6483608274590866},
    {"tan(-10.000000)", -0.6483608274590866},
    {"tan(+100.00000)", -0.5872139151569291},
    {"tan(-100.00000)", 0.5872139151569291},
    {"tan(+1000.0000)", 1.4703241557027185},
    {"tan(-1000.0000)", -1.4703241557027185},
    {"tan(+10000.000)", 0.3209711346238147},
    {"tan(-10000.000)", -0.3209711346238147},
    {"tan(+100000.00)", -0.035771662952898776},
    {"tan(-100000.00)", 0.035771662952898776},
    {"tan(+11.000000)", -225.95084645419513},
    {"tan(-11.000000)", 225.95084645419513},
    {"tan(+101.00000)", 0.5067526002248183},
    {"tan(-101.00000)", -0.5067526002248183},
    {"tan(+1001.0000)", -2.347271493609446},
    {"tan(-1001.0000)", 2.347271493609446},
    {"tan(+10001.000)", 3.7558782755606286},
    {"tan(-10001.000)", -3.7558782755606286},
    {"tan(+100001.00)", 1.4413376095907133},
    {"tan(-100001.00)", -1.4413376095907133},
    {"tan(+1000001.0)", 0.7483368346073866},
    {"tan(-1000001.0)", -0.7483368346073866},
    {"tan(+6.59705e7)", 1.910207885535329},
    {"tan(-6.59705e7)", -1.910207885535329},
    {"exp(1.0)", 2.718281828459045},
    {"exp(0.0)", 1.0},
    {"log(2.71828182845904523536028747135266249775724)", 1.0},
    {"hypot(3.0,4.0)", 5.0},
    {"hypot(1.0,sqrt(3.0))", 2.0},
    {"(1<2)?(3):(4)", 3.0},
    {"(1.1<2.2)?(3.3):(4.4)", 3.3},
    {"((1.0+1.1)<(2.0+1.2))?(3.3):(4.4)", 3.3},
    {"(1==2)?(3):(4)", 4.0},
    {"(1.1==2.2)?(3.3):(4.4)", 4.4},
    {"((1.0+1.1)==(2.0+1.2))?(3.3):(4.4)", 4.4},
    {"(1 == 2)?(3):(4)", 4.0},
    {"(1.1 == 2.2)?(3.3):(4.4)", 4.4},
    {"((1.0+1.1) == (2.0+1.2))?(3.3):(4.4)", 4.4},
    {"(1 >= 2)?(3):(4)", 4.0},
    {"(1.1 >= 2.2)?(3.3):(4.4)", 4.4},
    {"((1.0+1.1) >= (2.0+1.2))?(3.3):(4.4)", 4.4},
    {"(((1.0+2.0) == 3.0) && ((4.0+5.0)<9.0))?(1):(2)", 2.0},
    {"(3.0-1.0-2.0) == ((3.0-1.0)-2.0)", 1.0},
    {"sgn(0)", 0.0},
    {"sgn(+3)", 1.0},
    {"sgn(-3)", -1.0},
    {"1+2+3+4+5+6+7+8+9+0", 45.0},
    {"1+2+3+4+5+6+7+8+9+0", 45.0},
    {"1.0+2.0+3.0+4.0+5.0+6.0+7.0+8.0+9.0+0.0", 45.0},
    {"(1+2)+(3+4)+(5+6)+(7+8)+(9+0)", 45.0},
    {"(1-2)+(3-4)+(5-6)+(7-8)+(9-0)", 5.0},
    {"(1+2)-(3+4)-(5+6)-(7+8)-(9+0)", -39.0},
    {"(1.0+2.0)+(3.0+4.0)+(5.0+6.0)+(7.0+8.0)+(9.0+0.0)", 45.0},
    {"(1.0-2.0)+(3.0-4.0)+(5.0-6.0)+(7.0-8.0)+(9.0-0.0)", 5.0},
    {"(1.0+2.0)-(3.0+4.0)-(5.0+6.0)-(7.0+8.0)-(9.0+0.0)", -39.0},
    {"1+2-3*4/5+6-7*8/9+0", 0.37777777777777777},
    {"1.1+2.2-3.3*4.4/5.5+6.6-7.7*8.8/9.9+0.0", 0.41555555555555557},
    {"(1+2)-(3*4)/(5+6)-(7*8)/(9+0)", -4.313131313131313},
    {"1/1+1/2+1/3+1/4+1/5+1/6+1/7+1/8+1/9", 2.828968253968254},
    {"(1/1)+(1/2)+(1/3)+(1/4)+(1/5)+(1/6)+(1/7)+(1/8)+(1/9)", 2.828968253968254},
    {"1.0/1.0+1.0/2.0+1.0/3.0+1.0/4.0+1.0/5.0+1.0/6.0+1.0/7.0+1.0/8.0+1.0/9", 2.828968253968254},
    {"(1.0/1.0)+(1.0/2.0)+(1.0/3.0)+(1.0/4.0)+(1.0/5.0)+(1.0/6.0)+(1.0/7.0)+(1.0/8.0)+(1.0/9)", 2.828968253968254},
    {"1/1*1/2*1/3*1/4*1/5*1/6*1/7*1/8*1/9", 2.75573192239859e-06},
    {"(1/1)*(1/2)*(1/3)*(1/4)*(1/5)*(1/6)*(1/7)*(1/8)*(1/9)", 2.75573192239859e-06},
    {"1.0/1.0*1.0/2.0*1.0/3.0*1.0/4.0*1.0/5.0*1.0/6.0*1.0/7.0*1.0/8.0*1.0/9", 2.75573192239859e-06},
    {"(1.0/1.0)*(1.0/2.0)*(1.0/3.0)*(1.0/4.0)*(1.0/5.0)*(1.0/6.0)*(1.0/7.0)*(1.0/8.0)*(1.0/9)", 2.75573192239859e-06},
};

INSTANTIATE_TEST_SUITE_P(Functional_1, ExprtkFunctionalTest,
                         ::testing::ValuesIn(functional_tests_1));
